# little-research-lab-v3 — Quality Gates

These gates are **CI-blocking** unless explicitly overridden via a recorded decision (D-ID) and a spec update.

## Gate set
1) **Rules gate**: rules.yaml schema validation + required sections present
2) **Security gate**: auth rate limits, CSRF/session flags, XSS sanitizer tests, upload validation tests, redirect validation tests
3) **Privacy gate**: analytics schema enforcement (no forbidden fields), DB schema check for disallowed columns
4) **Reliability gate**: idempotent scheduler tests + DST tests
5) **Regression gate**: invariants R1–R6 must pass

## Standard commands (example; adapt to chosen runtime)
- Lint: `python -m ruff check .`
- Format (check): `python -m ruff format --check .`
- Typecheck: `python -m mypy .`
- Unit/Integration tests: `pytest -q --json-report --json-report-file=artifacts/pytest-report.json`
- Quality gates orchestrator:
  - `python scripts/quality_gates.py --out artifacts/quality_gates_run.json`

## Evidence artifacts (required)
- `artifacts/pytest-report.json`
- `artifacts/quality_gates_run.json`
- `artifacts/quality_gates_summary.md` (human-readable summary generated by gate runner)
- `artifacts/privacy_schema_report.json`
- `artifacts/rules_validation_report.json`
- Optional (only if coverage enforced):
  - `artifacts/coverage.json`

## CI blocking rules
- Any failing gate blocks merge/deploy.
- Overrides:
  - Must create a new decision entry (D-xxxx) with explicit expiration criteria.
  - Must add a spec note under “Quality Gate Overrides” referencing the D-ID.
  - Must add a task to remove the override.

## Minimum gate checks mapping (must exist)
- TA-0021/0022 (XSS)
- TA-0006/0007/0008/0009/0011 (uploads/headers)
- TA-0028/0029/0030/0027 (scheduler + DST)
- TA-0034/0035 (analytics schema + privacy)
- TA-0043/0044/0045 (redirect safety)
- R1–R6 regression suite
